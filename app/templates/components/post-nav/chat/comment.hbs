{{#liquid-if isEditing}}
  {{post-nav/chat/comment-form
    comment=comment
    cancelable=true
    classNames="comment-form-edit"
    cancel=(action "stopEditing")
    addComment=(action "stopEditing")
  }}
{{else if showAsDeleted}}
  <div class="comment-content comment-deleted">{{t "comments.deleted"}}</div>
{{else}}
  <div class="comment-content {{if isRouteComment 'is-route-comment'}} {{if comment.deleted 'comment-muted'}}">
    <div class="comment-profile">
      {{#link-to "users.user.profile.index" comment.user.username disabled=isCollapsedChild}}<img class="comment-avatar" src={{comment.user.userProfile.avatar}}>{{/link-to}}
      <div class="comment-pronouns">{{comment.user.userProfile.pronouns}}</div>
    </div>

    <div class="comment-main">
      <div class="comment-text {{if textIsOverflown 'comment-text-is-overflown'}}">
        {{#rich-text text=comment.text}}
          {{#link-to "users.user.profile.index" comment.user.username class="comment-user-link" disabled=isCollapsedChild classNames="comment-username-link"}}{{#if comment.user.userProfile.displayName}}{{{inject-emoji comment.user.userProfile.displayName}}} {{/if}}<span class="at-username">@{{comment.user.username}}</span>{{/link-to}}
        {{/rich-text}}

        {{#if textIsOverflown}}
          <a {{action "expandOverflow"}} class="comment-text-expand-overflow">{{t "comments.expandOverflow"}}</a>
        {{/if}}
      </div>
      <div class="comment-controls">
        {{sometimes-relative-date date=comment.date}}
        | {{post-nav/slideshow/post/controls/faves/main favable=comment}}
        | <a {{action "reply"}}>{{t "comments.reply"}}</a>
        {{#if (eq currentUser.user.id comment.user.id)}}
          | <a {{action "startEditing"}} disabled={{deleteDisabled}}>{{t "comments.edit"}}</a>
          | <a {{action "delete" comment}} disabled={{deleteDisabled}}>{{t "comments.delete"}}</a>
        {{else}}
          | <a {{action "report"}}>{{t "comments.report"}}</a>
        {{/if}}
      </div>
    </div>
  </div>
{{/liquid-if}}

{{#if replying}}
  {{post-nav/chat/comment-form
    post=post
    parent=replyParent
    commentable=comment
    isDeepReply=wouldDeepReply
    cancelable=true
    classNames="comment-form-reply"
    cancel=(action "closeReply")
    addComment=(action "closeReply")
  }}
{{/if}}

{{#if orderedFilteredChildren}}
  <div class="comment-children">
    {{#each orderedFilteredChildren as |child|}}
      {{post-nav/chat/comment comment=child isCollapsedChild=childrenAreCollapsed routeComment=routeComment wasClicked=(action "expandChildren") removeComment=(action "removeComment")}}
    {{/each}}

    {{#if childrenAreCollapsed}}
      <a {{action "expandChildren"}} class="comment-load-more">{{t "comments.loadMore"}}</a>
    {{/if}}
  </div>
{{/if}}
